<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="user-scalable=no">
    <title>OpenSiv3D for Web</title>
    <style>
      body {
        font-family: arial;
        overflow: hidden;
        padding: 0px;
        margin: 0px;
        background-color: gray;
      }

      #app {
        position: relative;
      }

      canvas.emscripten {
        border: 0px none;
        background-color: gray;
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <div id="app-container">
        <div id="canvas-container">
          <canvas
            class="emscripten"
            id="canvas"
            oncontextmenu="event.preventDefault()"
            tabindex="-1"
          ></canvas>
        </div>
      </div>
    </div>
    <script>
      const appContainer = document.querySelector("#app");

      function onResize() {
        setTimeout(doResize, 100);
      }

      function doResize() {
        Module["setFramebufferSize"](window.innerWidth * devicePixelRatio, window.innerHeight * devicePixelRatio);
      }

      var Module = {
        postRun: [ doResize ],
        canvas: (function () {
          var canvas = document.getElementById("canvas");

          // As a default initial behavior, pop up an alert when webgl context is lost. To make your
          // application robust, you may want to override this behavior before shipping!
          // See http://www.khronos.org/registry/webgl/specs/latest/1.0/#5.15.2
          canvas.addEventListener(
            "webglcontextlost",
            function (e) {
                alert("WebGL context lost. You will need to reload the page.");
                onRuntimeError();
                e.preventDefault();
            },
            false
          );

          return canvas;
        })(),
        onRuntimeInitialized: function() {
          window.addEventListener("resize", onResize);
        },
        dynamicLibraries: ["main.wasm"],
        setFramebufferSize: function(width, height) {
          if (!GLFW.active) return;
          let resizeNeeded = true;

          if (GLFW.active.width != width || GLFW.active.height != height) {
            GLFW.active.width = width;
            GLFW.active.height = height;
          } else {
            resizeNeeded = false;
          }

          if (resizeNeeded) {
            const canvas = Module['canvas'];
            canvas.width = GLFW.active.width;
            canvas.height = GLFW.active.height;

            GLFW.onWindowSizeChanged();
            GLFW.onFramebufferSizeChanged();
          }
        }
      }
    </script>
    <script src="Siv3D.js"></script>
  </body>
</html>
